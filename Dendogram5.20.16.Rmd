
---
title: "Dendogram Cup Assay"
author: "Devon"
date: "March 2, 2016"
output: html_document
---

#Agglomerative, Hierarchical Clustering
#Tests based on Standardized Data, Chord
(Red Hawk Cup Assay Data is used for the example)
```{r}
library(scales)
library(ggplot2)
library(plyr)
library(vegan)
library(cluster)
library(ade4)
library(stats)
rm(list = ls())
Y <- (read.csv("/Users/devonrossman/Desktop/CSVforR/DryBean/AllCupApr19.csv"))
Y3<-subset(Y, !(Y$rtarea=="NA") & !(Y$rtwght=="NA") & !(Y$Var=="Z")
           )
Y4<-( ddply(Y3, c("Var", "Title"), summarise,
               N    = length(rtwghttrial),
            meanwght = mean(rtwghttrial, na.rm=TRUE),
            meanlngth = mean(rtlngthtrial, na.rm=TRUE),
            meanarea = mean(rtareatrial, na.rm=TRUE),
            meanemerge = mean(emergetrial, na.rm=TRUE)))
Dend<-scale(as.matrix(Y4 [,c("meanwght", "meanlngth", "meanarea", "meanemerge")]))    
rownames(Dend)=Y4$Title
chord = function (s,diag) {
  # G.Nesslage, B.Maurer
  # computes chord distance
  # diag == TRUE returns full distance matrix
  # diag == FALSE returns distance matrix as dist object
  n = nrow(s)
  p <- ncol(s)
  D = matrix(0,n,n)
  m <- 1
  
  for (i in 1:(n-1)){
    for (j in (i+1):n){
      nd <- matrix(0,p,1)
      dd1 <- matrix(0,p,1)
      dd2 <- matrix(0,p,1)
      for (k in 1:p){
        nd[k,]<- s[i,k]*s[j,k]
        dd1[k,] <- (s[i,k])^2
        dd2[k,] <- (s[j,k])^2
      }
      D[i,j] <- sqrt(2*(1-(sum(nd)/sqrt(sum(dd1)*
                                          sum(dd2)))))
      D[j,i] <- D[i,j]
    }
  }
  
  if(diag==FALSE) {D=as.dist(D)}
  return (D)
}


rownames(Dend)=Y4$Title
chord1 <- chord(Dend,diag=FALSE)
chord.v <- as.vector(chord1)
label <- rownames(Dend)
chord.dis <- agnes(chord1, method="average", diss = TRUE) 
chord.disv<-as.vector(chord.dis)
# very simple dendrogram
plot(chord.dis, ask = FALSE, which.plots = 2,labels = label)

#Cophenetic Distance and Correlation
chord.ave.co <- cophenetic(chord.dis)
chord.ave.cov <- as.vector(chord.ave.co)
cor(chord.ave.cov, chord.v)
plot(y = chord.ave.cov, x = chord.v)

#Mantel Test
mant1 <- mantel.rtest(chord1, chord.ave.co, nrepet=1000)
#plot(mant1)
summary(mant1)

#RMSE
rmse <- function(x, dis.matrix){
 r.m.s.e <- 1- (mean(as.vector(x)^2))/var(as.vector(dis.matrix))
 return(r.m.s.e)
}
chord.co.resid <- chord.ave.cov - chord.v
rmse(chord.co.resid, chord.v)
```

Agglomerative hierarchical clustering - non-Chord template
```{r, echo=FALSE}
library(scales)
library(ggplot2)
library(plyr)
library(vegan)
library(cluster)
library(ade4)
library(stats)
rm(list = ls())
#install.packages("ade4")
Y <- (read.csv("/Users/devonrossman/Desktop/CSVforR/DryBean/AllCupApr19.csv"))
Y3<-subset(Y, !(Y$rtarea=="NA") & !(Y$rtwght=="NA") & !(Y$Var=="RH"))
Y4<-( ddply(Y3, c("Var", "Title"), summarise,
               N    = length(rtwghttrial),
            meanwght = mean(rtwghttrial, na.rm=TRUE),
            meanlngth = mean(rtlngthtrial, na.rm=TRUE),
            meanarea = mean(rtareatrial, na.rm=TRUE),
            meanemerge = mean(emergetrial, na.rm=TRUE)))
Dend<-scale(as.matrix(Y4 [,c("meanwght", "meanlngth", "meanarea", "meanemerge")]))    
rownames(Dend)=Y4$Title
bray <- (dist(Dend, method = "euclidean", diag = FALSE, upper = FALSE))
bray.v<-as.vector(bray)
bray.dis <- agnes(bray, method="average", diss = TRUE) 
bray.disv<-as.vector(bray.dis)
# very simple dendrogram
plot(bray.dis)
#Cophenetic Distances and Correlation
bray.ave.co <- cophenetic(bray.dis)
# vectorize the cophenetic distances
bray.ave.cov <- as.vector(bray.ave.co) 
cor(bray.ave.cov, bray.v)
plot(y = bray.ave.cov, x = bray.v)

#Mantel Test
mant1 <- mantel.rtest(bray, bray.ave.co, nrepet=1000)
#plot(mant1)
summary(mant1)

#RMSE
rmse <- function(x, dis.matrix){
 r.m.s.e <- 1- (mean(as.vector(x)^2))/var(as.vector(dis.matrix))
 return(r.m.s.e)
}
bray.co.resid <- bray.ave.cov - bray.v
rmse(bray.co.resid, bray.v)
```

#Divisive Clustering
Raw Data Relative to Trial
```{r}
library(plyr)
rm(list = ls())
Y <- (read.csv("/Users/devonrossman/Desktop/CSVforR/DryBean/AllCup.csv"))
Y3<-subset(Y, !(Y$rtarea=="NA") & !(Y$rtwght=="NA"))
Y4<-( ddply(Y3, c("Title"), summarise,
               N    = length(rtwght),
            meanwght = mean(rtwght, na.rm=TRUE),
            meanlngth = mean(rtlngth, na.rm=TRUE),
            meanarea = mean(rtarea, na.rm=TRUE), meanemerge = mean(Emerge, na.rm=TRUE)))
Dend<-scale(as.matrix(Y4 [,c("meanwght", "meanlngth", "meanarea", "meanemerge")]))
rownames(Dend)=Y4$Title
k.pot <- kmeans(as.matrix(Dend),5,100)
k.pot$cluster
kk<-as.matrix(k.pot$cluster)

```   

#Heat Map by Isolates
```{r}
library(pheatmap)
library(plyr)
Y <- (read.csv("/Users/devonrossman/Desktop/CSVforR/DryBean/AllCupApr19.csv"))
Y3<-subset(Y, !(Y$rtarea=="NA") & !(Y$rtwght=="NA") & (Y$Var=="RH"))
Y3$tisolate<-paste(Y3$Title,Y3$Trt)
Y4<-( ddply(Y3, c("Var", "tisolate"), summarise,
               N    = length(rtwght),
            meanwght = mean(rtwghttrial, na.rm=TRUE),
            meanlngth = mean(rtlngthtrial, na.rm=TRUE),
            meanarea = mean(rtareatrial, na.rm=TRUE), meanemerge = mean(emergetrial, na.rm=TRUE)))
stuff<-cbind(Y4$meanwght, Y4$meanlngth, Y4$meanarea, Y4$meanemerge)
rownames(stuff)<-Y4$tisolate
colnames(stuff)<-c("Root Dry Weight", "Root Length", "Root Area", "Emergence")
pheatmap(stuff, show_rownames = TRUE, show_colnames = TRUE, fontsize_row=9,
         #cluster_rows=hc.rows, 
         clustering_method="average")

```


#Chord Cup Assay Virulence cluster, across both Varieties
```{r}
library(pheatmap)
library(plyr)
rm(list = ls())
Y <- (read.csv("/Users/devonrossman/Desktop/CSVforR/DryBean/AllCupApr19.csv"))
Y3<-subset(Y, !(Y$rtarea=="NA") & !(Y$rtwght=="NA") #& (Y$Var=="Z")
           )
Y3$tisolate<-paste(Y3$Title,Y3$Trt)
Y4<-( ddply(Y3, c("Title"), summarise,
               N    = length(rtwght),
            meanwght = mean(rtwghttrial, na.rm=TRUE),
            meanlngth = mean(rtlngthtrial, na.rm=TRUE),
            meanarea = mean(rtareatrial, na.rm=TRUE), meanemerge = mean(emergetrial, na.rm=TRUE)))
stuff<-cbind(Y4$meanwght, Y4$meanlngth, Y4$meanarea, Y4$meanemerge)
rownames(stuff)=Y4$Title
chord = function (s,diag) {
  # G.Nesslage, B.Maurer
  # computes chord distance
  # diag == TRUE returns full distance matrix
  # diag == FALSE returns distance matrix as dist object
  n = nrow(s)
  p <- ncol(s)
  D = matrix(0,n,n)
  m <- 1
  
  for (i in 1:(n-1)){
    for (j in (i+1):n){
      nd <- matrix(0,p,1)
      dd1 <- matrix(0,p,1)
      dd2 <- matrix(0,p,1)
      for (k in 1:p){
        nd[k,]<- s[i,k]*s[j,k]
        dd1[k,] <- (s[i,k])^2
        dd2[k,] <- (s[j,k])^2
      }
      D[i,j] <- sqrt(2*(1-(sum(nd)/sqrt(sum(dd1)*
                                          sum(dd2)))))
      D[j,i] <- D[i,j]
    }
  }
  
  if(diag==FALSE) {D=as.dist(D)}
  return (D)
  
}
chord1 <- chord(stuff,diag=FALSE)
chord.dis <- agnes(chord1, method="average", diss = TRUE) 
hc.rows<-hclust(chord.dis$diss, method="average")
colnames(stuff)<-c("Root Dry Weight", "Root Length", "Root Area", "Emergence")
pheatmap(stuff, show_rownames = TRUE, show_colnames = TRUE,
         cluster_rows=hc.rows, 
         clustering_method="average")
```

#Chord Cup Assay Virulence cluster, Red Hawk
```{r}
library(pheatmap)
library(plyr)
rm(list = ls())
Y <- (read.csv("/Users/devonrossman/Desktop/CSVforR/DryBean/AllCupApr19.csv"))
Y3<-subset(Y, !(Y$rtarea=="NA") & !(Y$rtwght=="NA") & !(Y$Var=="Z")
           )
Y3$tisolate<-paste(Y3$Title,Y3$Trt)
Y4<-( ddply(Y3, c("Title"), summarise,
               N    = length(rtwght),
            meanwght = mean(rtwghttrial, na.rm=TRUE),
            meanlngth = mean(rtlngthtrial, na.rm=TRUE),
            meanarea = mean(rtareatrial, na.rm=TRUE), meanemerge = mean(emergetrial, na.rm=TRUE)))
stuff<-cbind(Y4$meanwght, Y4$meanlngth, Y4$meanarea, Y4$meanemerge)
rownames(stuff)=Y4$Title
chord = function (s,diag) {
  # G.Nesslage, B.Maurer
  # computes chord distance
  # diag == TRUE returns full distance matrix
  # diag == FALSE returns distance matrix as dist object
  n = nrow(s)
  p <- ncol(s)
  D = matrix(0,n,n)
  m <- 1
  
  for (i in 1:(n-1)){
    for (j in (i+1):n){
      nd <- matrix(0,p,1)
      dd1 <- matrix(0,p,1)
      dd2 <- matrix(0,p,1)
      for (k in 1:p){
        nd[k,]<- s[i,k]*s[j,k]
        dd1[k,] <- (s[i,k])^2
        dd2[k,] <- (s[j,k])^2
      }
      D[i,j] <- sqrt(2*(1-(sum(nd)/sqrt(sum(dd1)*
                                          sum(dd2)))))
      D[j,i] <- D[i,j]
    }
  }
  
  if(diag==FALSE) {D=as.dist(D)}
  return (D)
  
}
chord1 <- chord(stuff,diag=FALSE)
chord.dis <- agnes(chord1, method="average", diss = TRUE)
colnames(stuff)<-c("Root Dry Weight", "Root Length", "Root Area", "Emergence")
hc.rows<-hclust(chord.dis$diss)
pheatmap(stuff, show_rownames = TRUE, show_colnames = TRUE,
         cluster_rows=hc.rows,
         clustering_method = "average")
```

Chord Cup Assay Virulence cluster, Zorro
```{r}
library(pheatmap)
library(plyr)
rm(list = ls())
Y <- (read.csv("/Users/devonrossman/Desktop/CSVforR/DryBean/AllCupApr19.csv"))
Y3<-subset(Y, !(Y$rtarea=="NA") & !(Y$rtwght=="NA") & (Y$Var=="Z")
           )
Y3$tisolate<-paste(Y3$Title,Y3$Trt)
Y4<-( ddply(Y3, c("Title"), summarise,
               N    = length(rtwght),
            meanwght = mean(rtwghttrial, na.rm=TRUE),
            meanlngth = mean(rtlngthtrial, na.rm=TRUE),
            meanarea = mean(rtareatrial, na.rm=TRUE), meanemerge = mean(emergetrial, na.rm=TRUE)))
stuff<-cbind(Y4$meanwght, Y4$meanlngth, Y4$meanarea, Y4$meanemerge)
rownames(stuff)=Y4$Title
chord = function (s,diag) {
  # G.Nesslage, B.Maurer
  # computes chord distance
  # diag == TRUE returns full distance matrix
  # diag == FALSE returns distance matrix as dist object
  n = nrow(s)
  p <- ncol(s)
  D = matrix(0,n,n)
  m <- 1
  
  for (i in 1:(n-1)){
    for (j in (i+1):n){
      nd <- matrix(0,p,1)
      dd1 <- matrix(0,p,1)
      dd2 <- matrix(0,p,1)
      for (k in 1:p){
        nd[k,]<- s[i,k]*s[j,k]
        dd1[k,] <- (s[i,k])^2
        dd2[k,] <- (s[j,k])^2
      }
      D[i,j] <- sqrt(2*(1-(sum(nd)/sqrt(sum(dd1)*
                                          sum(dd2)))))
      D[j,i] <- D[i,j]
    }
  }
  
  if(diag==FALSE) {D=as.dist(D)}
  return (D)
  
}
chord1 <- chord(stuff,diag=FALSE)
rownames(stuff)<-Y4$Title
colnames(stuff)<-c("Root Dry Weight", "Root Length", "Root Area", "Emergence")
pheatmap(stuff, show_rownames = TRUE, show_colnames = TRUE,
         cluster_rows=chord1, 
         clustering_method="average")
```





Seed Rot Zorro, two temperatures
```{r}
library(pheatmap)
library(plyr)
rm(list = ls())
Y <- (read.csv("/Users/devonrossman/Desktop/CSVforR/DryBean/AllRot.csv"))
Y20<-subset(Y, #!(Y$SevPercent=="NA") & 
              (Y$Var=="Z") & Y$Temp=="20")
Y26<-subset(Y, #!(Y$SevPercent=="NA") & 
              (Y$Var=="Z") & Y$Temp=="26")
Sev26<-Y26$SevPercent
Y3<-cbind(Y20, Sev26)
Y3$tisolate<-paste(Y3$Title,Y3$Trt)
Y4<-( ddply(Y3, c("Var", "Title"), summarise,
               N    = length(SevPercent),
            sev20 = mean(SevPercent, na.rm=TRUE),
            sev26 = mean(Sev26, na.rm=TRUE)))
stuff<-as.data.frame(cbind(Y4$sev20, Y4$sev26))
rownames(stuff)<-Y4$Title
colnames(stuff)<-c("Severity 20C", "Severity 26C")
pheatmap(stuff, show_rownames = TRUE, show_colnames = TRUE,
         #cluster_rows=hc.rows, 
         clustering_method="average")

```

Seed Rot Red Hawk, two temperatures
```{r}
library(pheatmap)
library(plyr)
rm(list = ls())
Y <- (read.csv("/Users/devonrossman/Desktop/CSVforR/DryBean/AllRot.csv"))
Y20<-subset(Y, #!(Y$SevPercent=="NA") & 
              (Y$Var=="RH") & Y$Temp=="20")
Y26<-subset(Y, #!(Y$SevPercent=="NA") & 
              (Y$Var=="RH") & Y$Temp=="26")
Sev26<-Y26$SevPercent
Y3<-cbind(Y20, Sev26)
Y3$tisolate<-paste(Y3$Title,Y3$Trt)
Y4<-( ddply(Y3, c("Var", "Title"), summarise,
               N    = length(SevPercent),
            sev20 = mean(SevPercent, na.rm=TRUE),
            sev26 = mean(Sev26, na.rm=TRUE)))
stuff<-as.data.frame(cbind(Y4$sev20, Y4$sev26))
rownames(stuff)<-Y4$Title
colnames(stuff)<-c("Severity 20C", "Severity 26C")
pheatmap(stuff, show_rownames = TRUE, show_colnames = TRUE,
         #cluster_rows=hc.rows, 
         clustering_method="average")

```

Cup Assay pheatmap by variety
```{r}
library(scales)
library(ggplot2)
library(plyr)
library(vegan)
library(cluster)
library(ade4)
library(stats)
library(pheatmap)
rm(list = ls())
Y <- (read.csv("/Users/devonrossman/Desktop/CSVforR/DryBean/AllCup.csv"))
Y3<-subset(Y, !(Y$rtarea=="NA") & !(Y$rtwght=="NA") & !(Y$Var=="Z"))
Y4<-( ddply(Y3, c("Var", "Title"), summarise,
               N    = length(rtwghttrial),
            meanwght = mean(rtwghttrial, na.rm=TRUE),
            meanlngth = mean(rtlngthtrial, na.rm=TRUE),
            meanarea = mean(rtareatrial, na.rm=TRUE),
            meanemerge = mean(emergetrial, na.rm=TRUE)))
Dend<-scale(as.matrix(Y4 [,c("meanwght", "meanlngth", "meanarea", "meanemerge")]))    
rownames(Dend)=Y4$Title
chord = function (s,diag) {
  # G.Nesslage, B.Maurer
  # computes chord distance
  # diag == TRUE returns full distance matrix
  # diag == FALSE returns distance matrix as dist object
  n = nrow(s)
  p <- ncol(s)
  D = matrix(0,n,n)
  m <- 1
  
  for (i in 1:(n-1)){
    for (j in (i+1):n){
      nd <- matrix(0,p,1)
      dd1 <- matrix(0,p,1)
      dd2 <- matrix(0,p,1)
      for (k in 1:p){
        nd[k,]<- s[i,k]*s[j,k]
        dd1[k,] <- (s[i,k])^2
        dd2[k,] <- (s[j,k])^2
      }
      D[i,j] <- sqrt(2*(1-(sum(nd)/sqrt(sum(dd1)*
                                          sum(dd2)))))
      D[j,i] <- D[i,j]
    }
  }
  
  if(diag==FALSE) {D=as.dist(D)}
  return (D)
}
rownames(Dend)=Y4$Title
chord1 <- chord(Dend,diag=FALSE)
chord.v <- as.vector(chord1)
label <- rownames(Dend)
chord.dis <- agnes(chord1, method="average", diss = TRUE) 
chord.disv<-as.vector(chord.dis)
# very simple dendrogram
plot(chord.dis, ask = FALSE, which.plots = 2,labels = label)
hc.rows<-hclust(chord1, method="average")
colnames(Dend)<-c("Root Dry Weight", "Root Length", "Root Area", "Emergence")
pheatmap(Dend, show_rownames = TRUE, show_colnames = TRUE,
         cluster_rows=hc.rows, 
         clustering_method="average")
```




#Alphabetically sorted Severity by Temperature
```{r, echo=TRUE}
library(scales)
library(plyr)
library(vegan)
library(cluster)
library(ade4)
library(stats)
library(tabplot)
library(ggplot2)
#update.packages("tabplot")
rm(list = ls())
Y <- (read.csv("/Users/devonrossman/Desktop/CSVforR/DryBean/AllRotMay9.csv"))
Y3<-subset(Y, !(Y$Sev=="NA") #& !(Y$Var=="Z"))
)
Y4<-( ddply(Y3, c("Title", "Temp"), summarise,
               N    = length(Sev),
            meanSev = mean(Sev, na.rm=TRUE),
            medianSev = median(Sev),
            sdsev=sd(Sev),
            sesev= sdsev/sqrt(N)))

 limits<- cbind(Y4$meanSev+1.96*Y4$sesev, Y4$meanSev-1.96*Y4$sesev)
 colnames(limits)<-c("LL", "UL")
 Y4<-cbind(limits, Y4)
 Y4$Temp<-as.factor(Y4$Temp)
 
 ggplot(Y4, aes(x=Title, y=meanSev)) + 
   geom_point(aes(color=Y4$Temp ), stat = "summary", fun.y="mean", size=2) + 
   theme_light() +
   theme(axis.text.x=element_text(angle=90, hjust = 1, vjust = 0.5, face="italic")) +
   scale_color_manual(values=c("#80b1d3","#fb8072"))+
   geom_errorbar(aes(ymin=Y4$LL, ymax=Y4$UL, color=Y4$Temp, width=0.2))+
   labs(x="Species", y="Disease Severity Index", color="Temperature \n in degrees Celsius")
```

#Virulence sorted Severity by Temperature - Species
```{r, echo=FALSE}
library(scales)
library(plyr)
library(vegan)
library(cluster)
library(ade4)
library(stats)
library(tabplot)
library(ggplot2)
#update.packages("tabplot")
rm(list = ls())
Y <- (read.csv("/Users/devonrossman/Desktop/CSVforR/DryBean/AllRotMay9.csv"))
Y3<-subset(Y, !(Y$Sev=="NA") #& !(Y$Var=="Z"))
)
Y4<-aggregate(Y3$Sev, list(Y3$Title, Y3$Temp), na.rm=TRUE, mean)
se <- function(x) sqrt(var(x, na.rm=TRUE)/(length(na.omit(x))))
serror <- (aggregate(Y3$Sev, list(Y3$Title, Y3$Temp), se))
Y4 <- cbind(Y4, serror$x)
colnames(Y4) <- c("Title", "Temp", "sev", "SE")
limits<-aes(ymax=sev+(1.96*SE), ymin=sev-(1.96*SE))
Y4$Temp<-as.factor(Y4$Temp)

y <- ggplot(Y4, aes(y=sev, 
                    #fill=sdtrt, 
                    x=factor(Y4$Title), color=Y4$Temp))
y+geom_point(position="dodge", aes(x=reorder(Title, -sev)),  stat="identity")+
  theme_light()+
geom_errorbar(limits, stat="identity", width=0.3)+
labs(title="Emergence Effect of Pythium spp. Inoculation", x="Pythium spp.", y="Disease Severity Score")+
 theme(plot.title=element_text(size=20, colour="black"),
axis.title=element_text(size=13, colour="black"), axis.text.x=element_text(size=8, color="black", angle=90, hjust=1, vjust=1), axis.text.y=element_text(size=10, color="black"), strip.text.y = element_text(size = 10),
strip.text.x = element_text(size = 10, color="black"))+
scale_y_continuous(limits=c(0,1), oob=rescale_none)+
  geom_vline(xintercept=14.5)

```

#Virulence-sorted Severity by Temperature - Treatment
```{r, echo=FALSE}
library(scales)
library(plyr)
library(vegan)
library(cluster)
library(ade4)
library(stats)
library(tabplot)
library(ggplot2)
#update.packages("tabplot")
rm(list = ls())
Y <- (read.csv("/Users/devonrossman/Desktop/CSVforR/DryBean/AllRotMay9.csv"))
Y3<-subset(Y, !(Y$Sev=="NA") #& !(Y$Var=="Z"))
)
Y4<-aggregate(Y3$Sev, list(Y3$Trt, Y3$Clade, Y3$Temp), na.rm=TRUE, mean)
se <- function(x) sqrt(var(x, na.rm=TRUE)/(length(na.omit(x))))
serror <- (aggregate(Y3$Sev, list(Y3$Trt, Y3$Clade, Y3$Temp), se))
Y4 <- cbind(Y4, serror$x)
colnames(Y4) <- c("trt", "Clade", "Temp", "sev", "SE")
limits<-aes(ymax=sev+(1.96*SE), ymin=sev-(1.96*SE))
Y4$Temp<-as.factor(Y4$Temp)

y <- ggplot(Y4, aes(y=sev, 
                    #fill=sdtrt, 
                    x=factor(Y4$trt), shape=Y4$Temp, color=Y4$Clade))
y+geom_point(position="dodge", aes(x=reorder(trt, -sev)),  stat="identity", size=2.75)+
  theme_light()+
geom_errorbar(limits, stat="identity", width=0.3)+
labs(title="Emergence Effect of Pythium spp. Inoculation", x="Pythium spp.", y="Disease Severity Score")+
 theme(plot.title=element_text(size=20, colour="black"),
axis.title=element_text(size=13, colour="black"), axis.text.x=element_text(size=8, color="black", angle=90, hjust=1, vjust=1), axis.text.y=element_text(size=10, color="black"), strip.text.y = element_text(size = 10),
strip.text.x = element_text(size = 10, color="black"))+
scale_y_continuous(limits=c(0,1), oob=rescale_none)+
  geom_vline(xintercept=37.5)

```


#Validation of Model Selection for Seed Assay
```{r, echo=FALSE}
library(lme4)
Y <- (read.csv("/Users/devonrossman/Desktop/CSVforR/DryBean/AllRotMay9.csv"))
Y3<-subset(Y, !(Y$Sev=="NA") #& !(Y$Var=="Z"))
)
m1 <- lmer(Sev ~ Title*Var*Temp + (1 | Set) + (1 | Set:Trial) + (1 | Trial:Rep) + (1 | Iso:Title), data=Y3)
m2 <- lmer(Sev ~ Title*Var*Temp + (1 | Set) + (1 | Trial:Rep) + (1 | Iso:Title), data=Y3)
m3 <- lmer(Sev ~ Title*Var*Temp + (1 | Set) + (1 | Iso:Title), data=Y3)
m4 <- lmer(Sev ~ Title*Var*Temp-(Title:Var:Temp) + (1 | Set) + (1 | Iso:Title), data=Y3)
m5 <- lmer(Sev ~ Title*Var*Temp-(Title:Var:Temp) + (1 | Iso:Title), data=Y3)

m6 <- lmer(Sev ~ Title*Var*Temp-(Title:Var:Temp) + (1 | Iso), data=Y3)
a1<-anova(m2, m1, test="Chisq")
a2<-anova(m3, m2, test="Chisq")
a3<-anova(m4, m3, test="Chisq")
a4<-anova(m5, m4, test="Chisq")
a5<-anova(m6, m5, test="Chisq")

print(a1)
print(a2)
print(a3)
print(a4)
print(a5)

```

#Validation of Model Selection for Seedling Assay TRIAL
```{r, echo=FALSE}
library(lme4)
library(lsmeans)
library(pbkrtest)
library(nlme)
Y <- (read.csv("/Users/devonrossman/Desktop/CSVforR/DryBean/AllCupApr19.csv"))
Y3<-subset(Y, !(Y$rtwghttrial=="NA") & !(Y$rtareatrial=="NA") & !(Y$Trt=="2.5")
)
Y3$Trt<-as.factor(Y3$Trt)
Y3$Trt<-as.factor(Y3$Iso)
Y3$Trt<-as.factor(Y3$Set)
Y3$Trt<-as.factor(Y3$Trial)
fit <- lmer(rtwghttrial ~ Title*Var + (1|Iso), data=Y3)
fit1 <- lmer(rtwghttrial ~ Title*Var + (1|Iso) + (1|Set), data=Y3)
fit2 <- lmer(rtwghttrial ~ Title*Var + (1 | Set/Iso), data=Y3)
fit3 <- lmer(rtwghttrial ~ Title*Var + (1|Iso/Title/Set), data=Y3)
fit4 <- lmer(rtwghttrial ~ Title*Var + (1|Trial/Set) + (1|Iso/Title), data=Y3)
a<-anova(fit,fit1,fit2,fit3,fit4)
print(a)

#rg1<-ref.grid(m1, cov.reduce = mean, options = get.lsm.option("ref.grid"), Y3)
#ls1<-lsmeans(rg1, specs="Title", test=)

```



#Validation of Model Selection for Seedling Assay RAW
```{r, echo=FALSE}
library(lme4)
library(lsmeans)
library(pbkrtest)
library(nlme)
Y <- (read.csv("/Users/devonrossman/Desktop/CSVforR/DryBean/AllCupApr19.csv"))
Y3<-subset(Y, !(Y$rtwghttrial=="NA") & !(Y$rtareatrial=="NA") & !(Y$Trt=="2.5")
)
Y3$Trt<-as.factor(Y3$Trt)
Y3$Trt<-as.factor(Y3$Iso)
Y3$Trt<-as.factor(Y3$Set)
Y3$Trt<-as.factor(Y3$Trial)
fit <- lmer(rtwght ~ Title*Var +(1|Iso/Title)+(1|Trial/Set) + (1|Rep/Trial), data=Y3)
fit1 <- lmer(rtwght ~ Title*Var + (1|Iso/Title)+(1|Trial/Set), data=Y3)
fit2 <- lmer(rtwght ~ Title*Var + (1|Iso/Title)+(1|Set), data=Y3)
fit3 <- lmer(rtwght ~ Title*Var + (1|Iso/Title/Set), data=Y3)
fit4 <- lmer(rtwght ~ Title*Var + (1|Iso/Title)+ (Rep/Trial/Set), data=Y3)
a<-anova(fit,fit1,fit2,fit3,fit4)
print(a)

#rg1<-ref.grid(m1, cov.reduce = mean, options = #get.lsm.option("ref.grid"), Y3)
ls1<-lsmeans(fit4, pairwise~Title)
print(ls1)
#ls1<-lsmeans(rg1, specs="Title", test=)

```



#Validation of Model Selection for Seedling Assay RAWrtwght
``{r, echo=FALSE}
library(lme4)
library(lsmeans)
library(pbkrtest)
library(nlme)
Y <- (read.csv("/Users/devonrossman/Desktop/CSVforR/DryBean/AllCupApr19.csv"))
Y3<-subset(Y, !(Y$rtwghttrial=="NA") & !(Y$rtareatrial=="NA")
)
fit <- lme(cbind(rtwght) ~ Title*Var, random = ~1|Iso, data=Y3)
fit1 <- lme(cbind(rtwght) ~ Title*Var, random = ~1|Set, data=Y3)
fit2 <- lme(cbind(rtwght) ~ Title*Var, random = ~1|Set/Iso, data=Y3)
fit3 <- lme(cbind(rtwght) ~ Title*Var, random = ~1|Title/Iso, data=Y3)
fit4 <- lme(cbind(rtwght) ~ Title*Var, random = ~1|Set/Trial/Title/Iso, data=Y3)
a<-anova(fit,fit1,fit2, fit3, fit4)
print(a)

rg1<-ref.grid(m1, cov.reduce = mean, options = get.lsm.option("ref.grid"), Y3)
ls1<-lsmeans(rg1, specs="Title", test=)

```



#Validation of Model Selection for Seedling Assay TRIAL
``{r, echo=FALSE}
library(lme4)
library(lsmeans)
library(pbkrtest)
library(nlme)
Y <- (read.csv("/Users/devonrossman/Desktop/CSVforR/DryBean/AllCupApr19.csv"))
Y3<-subset(Y, !(Y$rtwghttrial=="NA") & !(Y$rtareatrial=="NA")
)
fit <- lme(cbind(rtareatrial, rtlngthtrial, rtwghttrial) ~ Title*Var, random= ~1|Iso, data=Y3)
fit1 <- lme(cbind(rtareatrial, rtlngthtrial, rtwghttrial) ~ Title*Var, random= ~1|Set/Iso, data=Y3)
fit2 <- lme(cbind(rtareatrial, rtlngthtrial, rtwghttrial) ~ Title*Var, random = ~1|Set, data=Y3)
fit3 <- lme(cbind(rtareatrial, rtlngthtrial, rtwghttrial) ~ Title*Var, random = ~1|Set/Title, data=Y3)
fit4 <- lme(cbind(rtwghttrial) ~ Title*Var, random = ~1|Set/Trial/Title/Iso, data=Y3)
a<-anova(fit,fit1,fit2, fit3, fit4)
print(a)
```